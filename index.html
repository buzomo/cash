<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‘›</text></svg>"
    />
    <title>Money</title>
    <style>
      body {
        font-family: monospace;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8e1e1; /* è–„ã„ãƒ”ãƒ³ã‚¯è‰² */
      }

      .balance-card {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        text-align: center;
        background-color: #ffeef2; /* æ¢…ã®èŠ±ã®ãƒ”ãƒ³ã‚¯è‰² */
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #f2d7d9; /* è–„ã„ãƒ”ãƒ³ã‚¯ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
      }

      th {
        background-color: #e91e63; /* æ¢…ã®èŠ±è‰²ã®ãƒ”ãƒ³ã‚¯ */
        color: white;
      }

      .amount-positive {
        color: #27ae60; /* æ¢…ã®èŠ±ã«åˆã†å„ªã—ã„ç·‘è‰² */
      }

      .amount-negative {
        color: #c0392b; /* èµ¤ç³»ã‚’æ®‹ã—ã¦ã€å°‘ã—æ¿ƒã„ãƒ”ãƒ³ã‚¯è‰² */
      }

      .input-row td {
        padding: 8px;
        background-color: #ffeef2; /* èƒŒæ™¯è‰²ã‚’æ¢…ã®èŠ±ã« */
      }

      .input-row input {
        width: 90%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .input-row button {
        background-color: #e91e63; /* æ¢…ã®èŠ±è‰²ã«è¿‘ã„ãƒ”ãƒ³ã‚¯ */
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
      }

      .input-row button:hover {
        background-color: #d81b60; /* æ¿ƒã„ãƒ”ãƒ³ã‚¯ã«å¤‰åŒ– */
      }

      .editable {
        cursor: pointer;
      }

      .editable:hover {
        background-color: #ffeef2; /* æ˜ã‚‹ã„ãƒ”ãƒ³ã‚¯ã« */
      }

      .editing input {
        width: 100%;
        padding: 8px;
        border: 1px solid #e91e63; /* ãƒ”ãƒ³ã‚¯ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
        border-radius: 4px;
        box-sizing: border-box;
      }

      tr.deletable:hover {
        background-color: #ffd1dc; /* æ¢…ã®èŠ±ã‚’æ„è­˜ã—ãŸè–„ã„ãƒ”ãƒ³ã‚¯ */
      }
    </style>
  </head>
  <body>
    <div class="balance-card" id="currentBalance">ï¿¥38,740</div>

    <table>
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>é‡‘é¡</th>
          <th>åç›®</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="transactionTable">
        <tr class="deletable">
          <td class="editable">2025-02-02</td>
          <td class="amount-positive editable">ï¿¥35,680</td>
          <td class="editable">æ®‹é«˜èª¿æ•´</td>
          <td></td>
        </tr>
        <tr class="deletable">
          <td class="editable">2025-02-02</td>
          <td class="amount-positive editable">ï¿¥6,000</td>
          <td class="editable">æ®‹é«˜èª¿æ•´</td>
          <td></td>
        </tr>
        <tr class="deletable">
          <td class="editable">2025-02-02</td>
          <td class="amount-negative editable">-ï¿¥1,180</td>
          <td class="editable">æ®‹é«˜èª¿æ•´</td>
          <td></td>
        </tr>
        <tr class="deletable">
          <td class="editable">2025-02-01</td>
          <td class="amount-negative editable">-ï¿¥460</td>
          <td class="editable">æ•£é«ª</td>
          <td></td>
        </tr>
        <tr class="deletable">
          <td class="editable">2025-02-01</td>
          <td class="amount-negative editable">-ï¿¥950</td>
          <td class="editable">ãƒ©ãƒ¼ãƒ¡ãƒ³åŠãƒãƒ£ãƒ¼ãƒãƒ³</td>
          <td></td>
        </tr>
        <tr class="deletable">
          <td class="editable">2025-02-01</td>
          <td class="amount-negative editable">-ï¿¥350</td>
          <td class="editable">ã‚³ãƒ¼ãƒ©ãƒ•ãƒ­ãƒ¼ãƒˆ</td>
          <td></td>
        </tr>
      </tbody>
      <tbody>
        <tr class="input-row">
          <td><input type="date" id="date" required="" /></td>
          <td>
            <input type="text" id="amount" placeholder="é‡‘é¡" required="" />
          </td>
          <td>
            <input
              type="text"
              id="description"
              placeholder="åç›®"
              required=""
            />
          </td>
          <td><button onclick="addTransaction()">è¿½åŠ </button></td>
        </tr>
      </tbody>
    </table>

    <script>
      let transactions = [
        {
          date: "2025-02-01",
          amount: -460,
          description: "æ•£é«ª",
        },
        {
          date: "2025-02-01",
          amount: -950,
          description: "ãƒ©ãƒ¼ãƒ¡ãƒ³åŠãƒãƒ£ãƒ¼ãƒãƒ³",
        },
        {
          date: "2025-02-01",
          amount: -350,
          description: "ã‚³ãƒ¼ãƒ©ãƒ•ãƒ­ãƒ¼ãƒˆ",
        },
        {
          date: "2025-02-02",
          amount: 35680,
          description: "æ®‹é«˜èª¿æ•´",
        },
        {
          date: "2025-02-02",
          amount: 6000,
          description: "æ®‹é«˜èª¿æ•´",
        },
      ];

      function getTodayDate() {
        const today = new Date();
        return today.toISOString().split("T")[0];
      }

      function setTodayDate() {
        document.getElementById("date").value = getTodayDate();
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("ja-JP", {
          style: "currency",
          currency: "JPY",
        }).format(amount);
      }

      function parseAmount(amountStr) {
        // æ•°å€¤ä»¥å¤–ã®æ–‡å­—ã‚’é™¤å»
        const numStr = amountStr.replace(/[,Â¥]/g, "");
        // +ã§å§‹ã¾ã‚‹å ´åˆã¯åå…¥ã¨ã—ã¦æ‰±ã†
        if (numStr.startsWith("+")) {
          return Math.abs(Number(numStr));
        }
        // ãã‚Œä»¥å¤–ã¯æ”¯å‡ºã¨ã—ã¦æ‰±ã†
        return -Math.abs(Number(numStr));
      }

      function saveFile() {
        const htmlContent = document.documentElement.outerHTML;

        const replaceStr = `let transactions = ${JSON.stringify(
          transactions,
          null,
          4
        )};`;
        const newContent = htmlContent.replace(searchStr, replaceStr);

        const blob = new Blob([newContent], { type: "text/html" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "money.html";
        a.click();
        URL.revokeObjectURL(a.href);
      }

      function startEditing(cell, index, field) {
        const transaction = transactions[index];
        const currentValue =
          field === "amount"
            ? Math.abs(transaction[field]).toString()
            : transaction[field];

        cell.classList.add("editing");
        const input = document.createElement("input");
        input.value = currentValue;

        if (field === "date") {
          input.type = "date";
        } else if (field === "amount") {
          input.type = "text";
          input.placeholder = "é‡‘é¡";
        } else {
          input.type = "text";
          input.placeholder = "åç›®";
        }

        const originalContent = cell.innerHTML;
        cell.innerHTML = "";
        cell.appendChild(input);
        input.focus();

        function finishEditing() {
          const newValue = input.value.trim();
          if (newValue) {
            if (field === "amount") {
              transactions[index][field] = parseAmount(newValue);
            } else {
              transactions[index][field] = newValue;
            }
            updateTable();
          } else {
            cell.innerHTML = originalContent;
          }
          cell.classList.remove("editing");
        }

        input.addEventListener("blur", finishEditing);
        input.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            finishEditing();
          }
        });
      }

      function updateTable() {
        const tbody = document.getElementById("transactionTable");
        tbody.innerHTML = "";

        const sortedTransactions = [...transactions].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        sortedTransactions.forEach((transaction, index) => {
          const row = tbody.insertRow();
          row.classList.add("deletable");

          const dateCell = row.insertCell();
          dateCell.textContent = transaction.date;
          dateCell.classList.add("editable");
          dateCell.addEventListener("dblclick", () =>
            startEditing(dateCell, index, "date")
          );

          const amountCell = row.insertCell();
          amountCell.textContent = formatCurrency(transaction.amount);
          amountCell.className =
            transaction.amount >= 0
              ? "amount-positive editable"
              : "amount-negative editable";
          amountCell.addEventListener("dblclick", () =>
            startEditing(amountCell, index, "amount")
          );

          const descCell = row.insertCell();
          descCell.textContent = transaction.description;
          descCell.classList.add("editable");
          descCell.addEventListener("dblclick", () =>
            startEditing(descCell, index, "description")
          );

          row.insertCell();

          // ãƒˆãƒªãƒ—ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§å‰Šé™¤
          let clickCount = 0;
          let clickTimer = null;
          row.addEventListener("click", () => {
            clickCount++;
            if (clickCount === 1) {
              clickTimer = setTimeout(() => {
                clickCount = 0;
              }, 400);
            } else if (clickCount === 3) {
              clearTimeout(clickTimer);
              clickCount = 0;
              if (confirm(`ã€Œ${transaction.description}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                transactions.splice(index, 1);
                updateTable();
              }
            }
          });
        });

        const balance = transactions.reduce((sum, t) => sum + t.amount, 0);
        document.getElementById("currentBalance").textContent =
          formatCurrency(balance);
      }

      function addTransaction() {
        const dateInput = document.getElementById("date");
        const amountInput = document.getElementById("amount");
        const descriptionInput = document.getElementById("description");

        if (dateInput.value && amountInput.value && descriptionInput.value) {
          const newTransaction = {
            date: dateInput.value,
            amount: parseAmount(amountInput.value),
            description: descriptionInput.value,
          };

          transactions.push(newTransaction);
          updateTable();

          amountInput.value = "";
          descriptionInput.value = "";
          setTodayDate();
          amountInput.focus();
        }
      }

      document.querySelectorAll(".input-row input").forEach((input) => {
        input.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            addTransaction();
          }
        });
      });

      document.addEventListener("keydown", function (e) {
        if (e.altKey && e.key === "s") {
          e.preventDefault();
          saveFile();
        }
      });

      updateTable();
      setTodayDate();
    </script>
  </body>
</html>
